# üîê –°–∏—Å—Ç–µ–º–∞ –ü—Ä–∞–≤ - –ü–æ–≤–Ω–∞ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

## üìã –û–≥–ª—è–¥

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ–∑–≤–æ–ª—è—î –∫–µ—Ä—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø–æ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ —Ä—ñ–∑–Ω–∏—Ö —á–∞—Å—Ç–∏–Ω –¥–æ–¥–∞—Ç–∫—É **–ë–ï–ó –ó–ú–Ü–ù–ò –ö–û–î–£**. –í—Å—ñ –ø—Ä–∞–≤–∞ –∫–µ—Ä—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ Google Sheets —Ç–∞ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å.

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

### üìä Google Sheets –¢–∞–±–ª–∏—Ü—ñ

#### **PermissionsCatalog** (–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–∞–≤)
–¢–∞–±–ª–∏—Ü—è –≤—Å—ñ—Ö –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–∞–≤ –≤ —Å–∏—Å—Ç–µ–º—ñ.

| permission_key | permission_label | category | subcategory | description | created_at |
|----------------|------------------|----------|-------------|-------------|------------|
| page:brands | –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ë—Ä–µ–Ω–¥—ñ–≤ | pages | entities | –î–æ—Å—Ç—É–ø –¥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É –±—Ä–µ–Ω–¥—ñ–≤ | 2024-01-01 |
| panel:aside-seo | –ü–∞–Ω–µ–ª—å SEO | panels | seo | –ë—ñ—á–Ω–∞ –ø–∞–Ω–µ–ª—å SEO —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ | 2024-01-01 |
| users:create | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ | actions | users | –ü—Ä–∞–≤–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ | 2024-01-01 |

**–§–æ—Ä–º–∞—Ç –∫–ª—é—á–∞:** `category:name` (—Ç—ñ–ª—å–∫–∏ a-z, 0-9, –¥–µ—Ñ—ñ—Å)

**–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó:**
- `pages` - –°—Ç–æ—Ä—ñ–Ω–∫–∏ –¥–æ–¥–∞—Ç–∫—É
- `panels` - –ë—ñ—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ —Ç–∞ –≤—ñ–¥–∂–µ—Ç–∏
- `actions` - –î—ñ—ó (CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó)

---

#### **RolePermissions** (–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∞–≤)
–¢–∞–±–ª–∏—Ü—è –∑–≤'—è–∑–∫—ñ–≤: —è–∫—ñ —Ä–æ–ª—ñ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ —è–∫–∏—Ö –ø—Ä–∞–≤.

| role_id | permission_key | granted |
|---------|----------------|---------|
| admin | page:brands | TRUE |
| editor | page:brands | TRUE |
| viewer | page:brands | FALSE |
| guest | page:brands | FALSE |

**–†–æ–ª—ñ:**
- `admin` - –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä (–º–∞—î –≤—Å—ñ –ø—Ä–∞–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
- `editor` - –†–µ–¥–∞–∫—Ç–æ—Ä
- `viewer` - –ì–ª—è–¥–∞—á
- `guest` - –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á

---

## üéØ –Ø–∫ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

### 1Ô∏è‚É£ –î–æ–¥–∞—Ç–∏ –ù–æ–≤–µ –ü—Ä–∞–≤–æ (—á–µ—Ä–µ–∑ UI)

1. –í—ñ–¥–∫—Ä–∏—Ç–∏ **–ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å** ‚Üí —Ç–∞–± **"–ü—Ä–∞–≤–∞"**
2. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ **"–î–æ–¥–∞—Ç–∏ –ø—Ä–∞–≤–æ"**
3. –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ñ–æ—Ä–º—É:
   ```
   –ö–ª—é—á: page:catalog
   –ù–∞–∑–≤–∞: –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ö–∞—Ç–∞–ª–æ–≥—É
   –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: pages
   –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è: (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
   –û–ø–∏—Å: –î–æ—Å—Ç—É–ø –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É —Ç–æ–≤–∞—Ä—ñ–≤
   ```
4. –ó–±–µ—Ä–µ–≥—Ç–∏

‚úÖ –ü—Ä–∞–≤–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î—Ç—å—Å—è –≤ Google Sheets (PermissionsCatalog)

---

### 2Ô∏è‚É£ –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –ü—Ä–∞–≤–æ –†–æ–ª—è–º

1. –í—ñ–¥–∫—Ä–∏—Ç–∏ **–ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å** ‚Üí —Ç–∞–± **"–î–æ—Å—Ç—É–ø–∏"**
2. –ó–Ω–∞–π—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–µ –ø—Ä–∞–≤–æ
3. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ –∫–Ω–æ–ø–∫—É **"üîì –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏"**
4. –û–±—Ä–∞—Ç–∏ —Ä–æ–ª—ñ —è–∫—ñ –º–∞—Ç–∏–º—É—Ç—å –¥–æ—Å—Ç—É–ø:
   ```
   ‚òëÔ∏è Admin
   ‚òëÔ∏è Editor
   ‚òê Viewer
   ‚òê Guest
   ```
5. –ó–±–µ—Ä–µ–≥—Ç–∏

‚úÖ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ Google Sheets (RolePermissions)

---

### 3Ô∏è‚É£ –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≤ HTML

–î–æ–¥–∞—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç `data-permission` –¥–æ –±—É–¥—å-—è–∫–æ–≥–æ HTML –µ–ª–µ–º–µ–Ω—Ç–∞:

```html
<!-- –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∏–º–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è admin —Ç–∞ editor -->
<button data-permission="page:brands" class="btn-primary">
    –í—ñ–¥–∫—Ä–∏—Ç–∏ –ë—Ä–µ–Ω–¥–∏
</button>

<!-- –ü–∞–Ω–µ–ª—å –≤–∏–¥–∏–º–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ç–∏—Ö —Ö—Ç–æ –º–∞—î –¥–æ—Å—Ç—É–ø -->
<aside data-permission="panel:aside-seo" class="panel-right">
    SEO —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
</aside>

<!-- –î—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è admin -->
<button data-permission="users:delete" class="btn-danger">
    –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
</button>
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**
1. –ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `initPermissions()`
2. –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –ø—Ä–∞–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ API
3. –í—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑ `data-permission` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è
4. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ù–ï –º–∞—î –ø—Ä–∞–≤–∞ - –µ–ª–µ–º–µ–Ω—Ç –ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è (`display: none`)

‚úÖ **ZERO CODE CHANGES** - –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞–π—Ç–µ –∞—Ç—Ä–∏–±—É—Ç!

---

## üîß API Endpoints

### –î–ª—è –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ø–æ—Ç—Ä–µ–±—É—î auth)

```javascript
// –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –ø—Ä–∞–≤–∞ –∑ –∫–∞—Ç–∞–ª–æ–≥—É
GET /api/permissions?action=list

// –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∞–≤–∞ –∑ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–º–∏ —Ä–æ–ª—è–º–∏
GET /api/permissions?action=assignments

// –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ –ø—Ä–∞–≤–æ
POST /api/permissions
{
  action: 'create',
  permission_key: 'page:catalog',
  permission_label: '–°—Ç–æ—Ä—ñ–Ω–∫–∞ –ö–∞—Ç–∞–ª–æ–≥—É',
  category: 'pages',
  subcategory: 'shop',
  description: '–î–æ—Å—Ç—É–ø –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É'
}

// –û–Ω–æ–≤–∏—Ç–∏ –ø—Ä–∞–≤–æ
PUT /api/permissions
{
  action: 'update',
  permission_key: 'page:catalog',
  permission_label: '–ù–æ–≤–∏–π –ö–∞—Ç–∞–ª–æ–≥'
}

// –í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∞–≤–æ
DELETE /api/permissions
{
  permission_key: 'page:catalog'
}

// –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –ø—Ä–∞–≤–æ —Ä–æ–ª—è–º
PUT /api/permissions
{
  action: 'assign',
  permission_key: 'page:catalog',
  roles: ['admin', 'editor', 'guest']
}
```

### –î–ª—è –§—Ä–æ–Ω—Ç–µ–Ω–¥—É (–ø—É–±–ª—ñ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø)

```javascript
// –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∞–≤–∞ –¥–ª—è —Ä–æ–ª—ñ
GET /api/permissions?action=user-permissions&role=viewer

// –í—ñ–¥–ø–æ–≤—ñ–¥—å:
{
  success: true,
  role: 'viewer',
  permissions: ['page:index', 'page:glossary', 'panel:aside-table']
}
```

---

## üíª JavaScript API

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ü—Ä–∞–≤

```javascript
import { hasPermission, initPermissions, refreshPermissions } from './utils/permissions.js';

// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –ø—Ä–∞–≤–æ
if (hasPermission('users:delete')) {
    console.log('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –≤–∏–¥–∞–ª—è—Ç–∏');
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º—É –ø—Ä–∞–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ)
await initPermissions();

// –û–Ω–æ–≤–∏—Ç–∏ –ø—Ä–∞–≤–∞ –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
await refreshPermissions();
```

### –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ï–ª–µ–º–µ–Ω—Ç—ñ–≤

```javascript
import { hideIfNoPermission, disableIfNoPermission } from './utils/permissions.js';

// –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç —è–∫—â–æ –Ω–µ–º–∞—î –ø—Ä–∞–≤–∞
hideIfNoPermission('#delete-btn', 'users:delete');

// –í–∏–º–∫–Ω—É—Ç–∏ –∫–Ω–æ–ø–∫—É —è–∫—â–æ –Ω–µ–º–∞—î –ø—Ä–∞–≤–∞
disableIfNoPermission('#save-btn', 'entities:edit');
```

---

## ‚ö†Ô∏è –£—Å—É–Ω–µ–Ω–Ω—è –ü—Ä–æ–±–ª–µ–º

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –¢–∞–±–ª–∏—Ü—ñ –ø–æ–∫–∞–∑—É—é—Ç—å 0 –∑–∞–ø–∏—Å—ñ–≤

**–°–∏–º–ø—Ç–æ–º:**
```
üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–∞–ª–æ–≥—É –ø—Ä–∞–≤...
üîÑ –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–∞–ª–æ–≥—É –ø—Ä–∞–≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó "pages": 0 —à—Ç.
```

**–ü—Ä–∏—á–∏–Ω–∞:** Google Sheets –Ω–µ –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω–∏—Ö –∞–±–æ —Ç–∞–±–ª–∏—Ü—ñ –Ω–∞–∑–≤–∞–Ω—ñ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†—ñ—à–µ–Ω–Ω—è:**

1Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ç–∞–±–ª–∏—Ü—ñ —ñ—Å–Ω—É—é—Ç—å —ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–∑–≤–∞–Ω—ñ:
   - –í—ñ–¥–∫—Ä–∏—Ç–∏ Google Sheets –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–∏—Å—Ç–∏ (tabs): **`PermissionsCatalog`** —Ç–∞ **`RolePermissions`**
   - –ù–∞–∑–≤–∏ –º–∞—é—Ç—å –±—É—Ç–∏ —Ç–æ—á–Ω–∏–º–∏ (case-sensitive)!

2Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—å:

**PermissionsCatalog** –º–∞—î –º–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏:
```
A          | B                | C        | D           | E           | F
-----------|------------------|----------|-------------|-------------|------------
permission_key | permission_label | category | subcategory | description | created_at
```

**RolePermissions** –º–∞—î –º–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏:
```
A       | B              | C
--------|----------------|--------
role_id | permission_key | granted
```

3Ô∏è‚É£ –î–æ–¥–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ:

**PermissionsCatalog (—Ä—è–¥–æ–∫ 2):**
```
page:test | –¢–µ—Å—Ç–æ–≤–∞ –°—Ç–æ—Ä—ñ–Ω–∫–∞ | pages |  | –¢–µ—Å—Ç–æ–≤–µ –ø—Ä–∞–≤–æ | 2024-01-01
```

**RolePermissions (—Ä—è–¥–æ–∫ 2):**
```
admin | page:test | TRUE
editor | page:test | TRUE
viewer | page:test | FALSE
guest | page:test | FALSE
```

4Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–Ω—Å–æ–ª—å:
```
‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ 1 –ø—Ä–∞–≤ –∑ –∫–∞—Ç–∞–ª–æ–≥—É
‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ 1 –ø—Ä–∞–≤ –∑ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º–∏
```

---

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∞–≤–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –¥–ª—è guest –∑–∞–º—ñ—Å—Ç—å admin

**–°–∏–º–ø—Ç–æ–º:**
```
üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∞–≤ –¥–ª—è —Ä–æ–ª—ñ: guest
```
(–ø—Ä–∏ —Ç–æ–º—É —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π —è–∫ admin)

**–ü—Ä–∏—á–∏–Ω–∞:** localStorage —â–µ –Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É `loadUserPermissions()`.

**–†—ñ—à–µ–Ω–Ω—è:** –í–∂–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ - –¥–æ–¥–∞–Ω–æ –∑–∞—Ç—Ä–∏–º–∫—É 100ms –ø—ñ—Å–ª—è `auth-state-changed`.

–Ø–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è:
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ DevTools ‚Üí Application ‚Üí Local Storage
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —î –∫–ª—é—á `userData` –∑ –ø–æ–ª–µ–º `role: 'admin'`
3. –Ø–∫—â–æ –Ω–µ–º–∞—î - –≤–∏–π—Ç–∏ —Ç–∞ —É–≤—ñ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ

---

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ï–ª–µ–º–µ–Ω—Ç–∏ –Ω–µ –ø—Ä–∏—Ö–æ–≤—É—é—Ç—å—Å—è

**–°–∏–º–ø—Ç–æ–º:** –ö–Ω–æ–ø–∫–∞ –∑ `data-permission="users:delete"` –≤–∏–¥–∏–º–∞ –¥–ª—è viewer

**–ü—Ä–∏—á–∏–Ω–∞:**
1. `initPermissions()` –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
2. –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –¥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è DOM
3. –ü—Ä–∞–≤–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–µ –≤—Å—ñ–º —Ä–æ–ª—è–º

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
   ```
   üîê –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–∞–≤...
   ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –∞—Ç—Ä–∏–±—É—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
   ```html
   <!-- –ü–†–ê–í–ò–õ–¨–ù–û -->
   <button data-permission="users:delete">...</button>

   <!-- –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û -->
   <button data-permissions="users:delete">...</button>
   <button permission="users:delete">...</button>
   ```

3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤ Google Sheets ‚Üí RolePermissions:
   ```
   viewer | users:delete | FALSE  ‚Üê –º–∞—î –±—É—Ç–∏ FALSE!
   ```

---

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: API –ø–æ–≤–µ—Ä—Ç–∞—î 401 Unauthorized

**–°–∏–º–ø—Ç–æ–º:**
```
‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∞–≤: Unauthorized
```

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ–π –∞–±–æ –Ω–µ–¥—ñ–π—Å–Ω–∏–π.

**–†—ñ—à–µ–Ω–Ω—è:**
1. –î–ª—è –∞–¥–º—ñ–Ω endpoints (list, create, update, delete) - –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —è–∫ admin
2. –î–ª—è user-permissions endpoint - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –ù–ï –ø–æ—Ç—Ä—ñ–±–Ω–∞
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π endpoint:
   ```javascript
   // –ü—É–±–ª—ñ—á–Ω–∏–π (–±–µ–∑ auth)
   GET /api/permissions?action=user-permissions&role=viewer

   // –ê–¥–º—ñ–Ω (–ø–æ—Ç—Ä–µ–±—É—î auth)
   GET /api/permissions?action=list
   ```

---

## üìù –ü—Ä–∏–∫–ª–∞–¥–∏ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ü—Ä–∏–∫–ª–∞–¥ 1: –°—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç—ñ–ª—å–∫–∏ –¥–ª—è admin

```html
<div data-permission="page:users-admin">
    <h1>–ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å</h1>
    <!-- –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –¥–ª—è –Ω–µ-admin -->
</div>
```

### –ü—Ä–∏–∫–ª–∞–¥ 2: –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è editor —Ç–∞ admin

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–æ `entities:delete` –≤ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—ñ
2. –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ —Ä–æ–ª—è–º `admin` —Ç–∞ `editor`
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≤ HTML:

```html
<button data-permission="entities:delete" class="btn-danger">
    –í–∏–¥–∞–ª–∏—Ç–∏ –°—É—Ç–Ω—ñ—Å—Ç—å
</button>
```

### –ü—Ä–∏–∫–ª–∞–¥ 3: Guest –º–æ–∂–µ –±–∞—á–∏—Ç–∏ –ø—É–±–ª—ñ—á–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–æ `page:public-catalog`
2. –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ —Ä–æ–ª–ª—è–º `admin`, `editor`, `viewer`, **`guest`**
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏:

```html
<a href="/catalog" data-permission="page:public-catalog">
    –ü—É–±–ª—ñ—á–Ω–∏–π –ö–∞—Ç–∞–ª–æ–≥
</a>
```

### –ü—Ä–∏–∫–ª–∞–¥ 4: –ü–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ –º–æ–¥—É–ª—å

```javascript
// entities-manage.js
import {
    hasPermission,
    hideIfNoPermission,
    initPermissions
} from './utils/permissions.js';

async function renderEntitiesTable(entities) {
    const rows = entities.map(entity => {
        const actions = [];

        // –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –ø—Ä–∞–≤–æ)
        if (hasPermission('entities:edit')) {
            actions.push(`<button class="btn-edit" data-id="${entity.id}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>`);
        }

        // –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –ø—Ä–∞–≤–æ)
        if (hasPermission('entities:delete')) {
            actions.push(`<button class="btn-delete" data-id="${entity.id}">–í–∏–¥–∞–ª–∏—Ç–∏</button>`);
        }

        return `
            <tr>
                <td>${entity.name}</td>
                <td>${entity.description}</td>
                <td>${actions.join(' ')}</td>
            </tr>
        `;
    }).join('');

    document.getElementById('entities-table').innerHTML = rows;

    // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è —è–∫—â–æ –Ω–µ–º–∞—î –ø—Ä–∞–≤–∞
    hideIfNoPermission('#add-entity-btn', 'entities:add');
}
```

---

## üöÄ Workflow

```
1. –ê–¥–º—ñ–Ω —Å—Ç–≤–æ—Ä—é—î –ø—Ä–∞–≤–æ ‚Üí PermissionsCatalog (Google Sheets)
2. –ê–¥–º—ñ–Ω –ø—Ä–∏–∑–Ω–∞—á–∞—î —Ä–æ–ª–ª—è–º ‚Üí RolePermissions (Google Sheets)
3. –†–æ–∑—Ä–æ–±–Ω–∏–∫ –¥–æ–¥–∞—î data-permission ‚Üí HTML
4. initPermissions() –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –ø—Ä–∞–≤–∞ ‚Üí API
5. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏—Ö–æ–≤—É—î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
6. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –¥–æ–∑–≤–æ–ª–µ–Ω–µ ‚Üí ‚úÖ
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ:
- [ ] Google Sheets –º—ñ—Å—Ç–∏—Ç—å –ª–∏—Å—Ç–∏ `PermissionsCatalog` —Ç–∞ `RolePermissions` (—Ç–æ—á–Ω—ñ –Ω–∞–∑–≤–∏!)
- [ ] –¢–∞–±–ª–∏—Ü—ñ –º–∞—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (permission_key, permission_label, category...)
- [ ] –Ñ —Ö–æ—á–∞ –± 1 –∑–∞–ø–∏—Å —É `PermissionsCatalog`
- [ ] –Ñ —Ö–æ—á–∞ –± 1 –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤ `RolePermissions` (admin ‚Üí page:test ‚Üí TRUE)
- [ ] –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—É—î: `‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ X –ø—Ä–∞–≤ –¥–ª—è —Ä–æ–ª—ñ admin` (–Ω–µ guest!)
- [ ] –ö–æ–Ω—Å–æ–ª—å –ù–ï –ø–æ–∫–∞–∑—É—î –ø–æ–º–∏–ª–æ–∫ —Ç–∏–ø—É "Failed to load permissions"
- [ ] –ï–ª–µ–º–µ–Ω—Ç–∏ –∑ `data-permission` –ø—Ä–∏—Ö–æ–≤—É—é—Ç—å—Å—è –¥–ª—è —Ä–æ–ª–µ–π –±–µ–∑ –¥–æ—Å—Ç—É–ø—É
- [ ] –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å ‚Üí —Ç–∞–± "–ü—Ä–∞–≤–∞" –ø–æ–∫–∞–∑—É—î —Å–ø–∏—Å–æ–∫ –ø—Ä–∞–≤
- [ ] –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å ‚Üí —Ç–∞–± "–î–æ—Å—Ç—É–ø–∏" –ø–æ–∫–∞–∑—É—î –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

---

## üéì –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –§–∞–π–ª—ñ–≤

```
api/permissions/index.js                           - API –¥–ª—è –ø—Ä–∞–≤
js/utils/permissions.js                            - –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∞ –ª–æ–≥—ñ–∫–∞
js/main-core.js                                    - –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏
js/users-admin/
  ‚îú‚îÄ‚îÄ users-admin-permissions-catalog-table.js     - –¢–∞–±–ª–∏—Ü—è –∫–∞—Ç–∞–ª–æ–≥—É
  ‚îú‚îÄ‚îÄ users-admin-permissions-catalog-modal.js     - –ú–æ–¥–∞–ª–∫–∞ CRUD –ø—Ä–∞–≤
  ‚îú‚îÄ‚îÄ users-admin-permissions-assignments-table.js - –¢–∞–±–ª–∏—Ü—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å
  ‚îú‚îÄ‚îÄ users-admin-permissions-assignments-modal.js - –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
  ‚îî‚îÄ‚îÄ users-admin-init.js                          - –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞–±—ñ–≤
templates/modals/
  ‚îú‚îÄ‚îÄ permission-catalog-modal.html                - –ú–æ–¥–∞–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∞–≤–∞
  ‚îî‚îÄ‚îÄ permission-modal.html                        - –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
```

---

## üîî –ü–æ–¥—ñ—ó

```javascript
// –°–ø—Ä–∞—Ü—å–æ–≤—É—î –∫–æ–ª–∏ –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–∞–≤ –∑–º—ñ–Ω—é—î—Ç—å—Å—è (create/update/delete)
document.addEventListener('permissions-catalog-changed', async () => {
    console.log('–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–∞–≤ –æ–Ω–æ–≤–ª–µ–Ω–æ');
    // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é
});

// –°–ø—Ä–∞—Ü—å–æ–≤—É—î –∫–æ–ª–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–º—ñ–Ω—é—é—Ç—å—Å—è (assign)
document.addEventListener('permissions-assignments-changed', async () => {
    console.log('–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∞–≤ –æ–Ω–æ–≤–ª–µ–Ω–æ');
    // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é
});

// –°–ø—Ä–∞—Ü—å–æ–≤—É—î –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—Ö–æ–¥–∏—Ç—å/–≤–∏—Ö–æ–¥–∏—Ç—å
document.addEventListener('auth-state-changed', async (event) => {
    console.log('–°—Ç–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∑–º—ñ–Ω–µ–Ω–æ:', event.detail);
    // –û–Ω–æ–≤–∏—Ç–∏ –ø—Ä–∞–≤–∞
});
```

---

**–ê–≤—Ç–æ—Ä:** Claude Code ü§ñ
**–í–µ—Ä—Å—ñ—è:** 3.0 (–ü–æ–≤–Ω–∞ –ü–µ—Ä–µ—Ä–æ–±–∫–∞)
**–î–∞—Ç–∞:** 2025-01-15
**–ö–æ–º—ñ—Ç–∏:** [4454961](https://github.com/DSMykyta/pinguinV5/commit/4454961), [c5bd36b](https://github.com/DSMykyta/pinguinV5/commit/c5bd36b), [22605f3](https://github.com/DSMykyta/pinguinV5/commit/22605f3)
