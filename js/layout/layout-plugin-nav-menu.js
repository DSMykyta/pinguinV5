// js/layout/layout-plugin-nav-menu.js

/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘                      Ğ›Ğ†Ğ’Ğ ĞĞĞ’Ğ†Ğ“ĞĞ¦Ğ†Ğ™ĞĞ ĞŸĞĞĞ•Ğ›Ğ¬ (MENU)                      â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                          â•‘
 * â•‘  Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑ” HTML ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ğ»Ñ–Ğ²Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ñ– Ğ¿Ñ–Ğ´ÑĞ²Ñ–Ñ‡ÑƒÑ” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñƒ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºÑƒ.        â•‘
 * â•‘                                                                          â•‘
 * â•‘  ğŸ“‹ Ğ©Ğ Ğ ĞĞ‘Ğ˜Ğ¢Ğ¬:                                                           â•‘
 * â•‘  â”œâ”€â”€ Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑ” templates/partials/nav.html Ñƒ #main-nav                  â•‘
 * â•‘  â”œâ”€â”€ Ğ”Ğ¾Ğ´Ğ°Ñ” ĞºĞ»Ğ°Ñ .active Ğ½Ğ° Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ñ— ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ¸                   â•‘
 * â•‘  â””â”€â”€ Click-toggle expanded/collapsed Ğ´Ğ»Ñ .nav.column                    â•‘
 * â•‘                                                                          â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

import { loadHTML } from '../utils/html-loader.js';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ğ’ĞĞ£Ğ¢Ğ Ğ†Ğ¨ĞĞ¯ Ğ›ĞĞ“Ğ†ĞšĞ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function setActiveLink(nav) {
    const currentPage = window.location.pathname.split('/').pop() || 'index.html';
    const links = nav.querySelectorAll('.nav-main a.btn-icon');

    links.forEach(link => {
        if (link.getAttribute('href') === currentPage) {
            link.classList.add('active');
        }
    });
}

/**
 * Ğ”ĞµĞ»ĞµĞ³Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ click-toggle Ğ´Ğ»Ñ Ğ²ÑÑ–Ñ… .nav-toggle ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº.
 * ĞŸÑ€Ğ°Ñ†ÑÑ” Ñ– Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ¾Ğ²Ğ¾Ñ— Ğ½Ğ°Ğ²Ñ–Ğ³Ğ°Ñ†Ñ–Ñ—, Ñ– Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ñ….
 */
function initNavToggle() {
    document.addEventListener('click', (e) => {
        const toggle = e.target.closest('.nav-toggle');
        if (!toggle) return;

        const nav = toggle.closest('.nav.column');
        if (!nav) return;

        nav.classList.toggle('expanded');

        // Ğ”Ğ»Ñ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ¾Ğ²Ğ¾Ñ— Ğ½Ğ°Ğ²Ñ–Ğ³Ğ°Ñ†Ñ–Ñ— â€” Ğ·ÑÑƒĞ² ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ñƒ
        if (nav.id === 'main-nav') {
            document.body.classList.toggle('nav-expanded', nav.classList.contains('expanded'));
        }
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ĞŸĞ£Ğ‘Ğ›Ğ†Ğ§ĞĞ• API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ğŸ”Œ ĞŸĞ›ĞĞ“Ğ†Ğ â€” Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑ” nav ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ñ– Ğ¿Ñ–Ğ´ÑĞ²Ñ–Ñ‡ÑƒÑ” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñƒ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºÑƒ.
 */
export async function init() {
    const nav = document.getElementById('main-nav');
    if (!nav) return;

    await loadHTML('templates/partials/nav.html', nav);

    // Ğ”Ğ»Ñ Ğ½ĞµĞ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ… â€” Ğ²Ğ¸Ğ´Ğ°Ğ»ÑÑ”Ğ¼Ğ¾ nav-main Ğ· DOM (Ğ½Ğµ display:none)
    if (!window.isAuthorized) {
        const navMain = nav.querySelector('.nav-main');
        if (navMain) navMain.remove();
    } else {
        setActiveLink(nav);
    }

    // Toggle expanded/collapsed Ğ´Ğ»Ñ nav.column
    initNavToggle();
}
