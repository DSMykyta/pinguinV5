// js/generators/generator-table/gt-magic-normalize.js

/**
 * ╔══════════════════════════════════════════════════════════════════════════╗
 * ║                    GT-MAGIC-NORMALIZE v1.0                               ║
 * ║              Нормалізація назв нутрієнтів                                ║
 * ╚══════════════════════════════════════════════════════════════════════════╝
 *
 * ПРИЗНАЧЕННЯ:
 * Приводить назви нутрієнтів до стандартного вигляду:
 * - Calories → Калории
 * - Total Fat → Жиры
 * - Saturated Fat → - насыщенные
 *
 * ЕКСПОРТ:
 * - normalizeNutrientName(name) - нормалізувати назву
 * - isUkrainian(text) - визначити мову тексту
 * - NORMALIZATION_MAP - мапа нормалізації
 */

// ============================================================================
// МАПА НОРМАЛІЗАЦІЇ
// ============================================================================

/**
 * Мапа нормалізації назв нутрієнтів
 * Формат: [regex, російська форма, українська форма]
 */
export const NORMALIZATION_MAP = [
    // Калории
    [/^(калорийность|энергетическая ценность|калорій|енергетична цінність|calories|energy|kcal)$/i,
     'Калории', 'Калорії'],

    // - от жиров (підкатегорія калорій)
    [/^(от жиров|від жирів|from fat|calories from fat)$/i,
     ' - от жиров', ' - від жирів'],

    // Жиры (основна категорія)
    [/^(жир|жиров|жири|жирів|fat|fats|total fat|общее содержание жира|загальний вміст жиру)$/i,
     'Жиры', 'Жири'],

    // - насыщенные (підкатегорія жирів)
    [/^(насыщенные жиры|насыщенных жиров|насыщенные|насичені жири|насичені|saturated fat|saturated)$/i,
     ' - насыщенные', ' - насичені'],

    // - транс-жиры (підкатегорія жирів)
    [/^(транс-?жиры|транс-?жирів|трансжиры|trans fat|trans)$/i,
     ' - транс-жиры', ' - транс-жири'],

    // Холестерин
    [/^(холестерин|холестерина|холестерол|cholesterol)$/i,
     'Холестерин', 'Холестерин'],

    // Натрий
    [/^(натрий|натрия|натрій|натрію|sodium)$/i,
     'Натрий', 'Натрій'],

    // Углеводы (основна категорія)
    [/^(углеводы|углеводов|вуглеводи|вуглеводів|carbohydrates|carbs|total carbohydrate|общее количество углеводов|загальна кількість вуглеводів)$/i,
     'Углеводы', 'Вуглеводи'],

    // - сахар (підкатегорія вуглеводів)
    [/^(сахар|сахара|цукор|цукру|sugar|sugars|total sugars|общее содержание сахара|загальний вміст цукру)$/i,
     ' - сахар', ' - цукор'],

    // - добавленного сахара (підпідкатегорія)
    [/^(добавленн?ый сахар|добавленного сахара|доданий цукор|added sugar|includes.*added)$/i,
     ' - добавленного сахара', ' - доданого цукру'],

    // - пищевые волокна (підкатегорія вуглеводів)
    [/^(клетчатка|пищевые волокна|пищевых волокон|харчові волокна|dietary fiber|fiber|fibre)$/i,
     ' - пищевые волокна', ' - харчові волокна'],

    // Белок
    [/^(белок|белки|белков|білок|білка|білків|protein|proteins)$/i,
     'Белок', 'Білок'],

    // Соль
    [/^(соль|солі|salt)$/i,
     'Соль', 'Сіль'],
];

// ============================================================================
// ФУНКЦІЇ
// ============================================================================

/**
 * Визначає мову тексту (українська чи російська)
 * @param {string} text - Текст для аналізу
 * @returns {boolean} - true якщо українська
 */
export function isUkrainian(text) {
    if (!text) return false;

    // Українські літери
    if (/[іїєґ]/i.test(text)) return true;

    // Українські слова без специфічних літер
    if (/^(цукор|цукру|жири|жирів|вуглеводи|білок|білка|сіль|солі)$/i.test(text)) return true;

    return false;
}

/**
 * Нормалізує назву нутрієнту
 * @param {string} name - Оригінальна назва
 * @returns {string} - Нормалізована назва
 */
export function normalizeNutrientName(name) {
    if (!name) return '';

    let normalized = name.replace(/:$/, '').trim();
    const ua = isUkrainian(normalized);

    for (const [regex, ruForm, uaForm] of NORMALIZATION_MAP) {
        if (regex.test(normalized)) {
            return ua ? uaForm : ruForm;
        }
    }

    return normalized;
}
