// js/generators/generator-table/gt-magic-normalize.js

/**
 * ╔══════════════════════════════════════════════════════════════════════════╗
 * ║                    GT-MAGIC-NORMALIZE v1.0                               ║
 * ║              Нормалізація назв нутрієнтів                                ║
 * ╚══════════════════════════════════════════════════════════════════════════╝
 *
 * ПРИЗНАЧЕННЯ:
 * Спрощує назви нутрієнтів до стандартного вигляду:
 * - "Всего углеводов" → "Углеводы"
 * - "Насыщенные жиры" → " - насыщенные"
 * - "Всього вуглеводів" → "Вуглеводи"
 *
 * ЕКСПОРТ:
 * - normalizeNutrientName(name) - нормалізувати назву
 */

// ============================================================================
// МАПА НОРМАЛІЗАЦІЇ
// ============================================================================

/**
 * Мапа нормалізації назв нутрієнтів
 * Формат: [regex, нормалізована форма]
 */
const NORMALIZATION_MAP = [
    // === КАЛОРІЇ ===
    [/^(калорийность|энергетическая ценность|калорії|енергетична цінність|energy|kcal)$/i, 'Калории'],

    // === ЖИРИ ===
    [/^(всего жир(ов|а)?|общ(ее|ий) (содержание )?жир(ов|а)?|total fat|жири|загальний вміст жиру)$/i, 'Жиры'],
    [/^(насыщенн?(ые|ых)( жир(ы|ов)?)?|saturated( fat)?|насичені( жири)?)$/i, ' - насыщенные'],
    [/^(транс[- ]?жир(ы|ов)?|trans( fat)?)$/i, ' - транс-жиры'],
    [/^(ненасыщенн?(ые|ых)( жир(ы|ов)?)?|unsaturated|ненасичені)$/i, ' - ненасыщенные'],
    [/^(мононенасыщенн?(ые|ых)?|monounsaturated)$/i, ' - мононенасыщенные'],
    [/^(полиненасыщенн?(ые|ых)?|polyunsaturated)$/i, ' - полиненасыщенные'],

    // === ХОЛЕСТЕРИН ===
    [/^(холестерин(а)?|холестерол|cholesterol)$/i, 'Холестерин'],

    // === НАТРІЙ ===
    [/^(натрий|натрия|натрій|натрію|sodium)$/i, 'Натрий'],

    // === ВУГЛЕВОДИ ===
    [/^(всего углевод(ов|ы)?|общ(ее|ий) (количество |содержание )?углевод(ов|ы)?|total carb(ohyd)?r?(ate)?s?|вуглеводи|загальна кількість вуглеводів)$/i, 'Углеводы'],
    [/^(пищев(ые|ых) волокн(а|о)?|клетчатк(а|и)|dietary fiber|fibre?|харчові волокна)$/i, ' - пищевые волокна'],
    [/^(всего сахар(ов|а)?|сахар(а)?|total sugars?|sugars?|цукор|цукру)$/i, ' - сахар'],
    [/^(добавленн?(ый|ого) сахар(а)?|added sugars?|includes.*added|доданий цукор)$/i, ' - добавленного сахара'],

    // === БІЛОК ===
    [/^(белок|белки|белков|білок|білка|білків|protein)$/i, 'Белок'],

    // === СІЛЬ ===
    [/^(соль|солі|salt)$/i, 'Соль'],

    // === КАЛІЙ ===
    [/^(калий|калия|калій|калію|potassium)$/i, 'Калий'],

    // === КАЛЬЦІЙ ===
    [/^(кальций|кальция|кальцій|кальцію|calcium)$/i, 'Кальций'],

    // === ЗАЛІЗО ===
    [/^(железо|железа|залізо|заліза|iron)$/i, 'Железо'],
];

// ============================================================================
// ГОЛОВНА ФУНКЦІЯ
// ============================================================================

/**
 * Нормалізує назву нутрієнту
 * @param {string} name - Оригінальна назва
 * @returns {string} - Нормалізована назва
 *
 * @example
 * normalizeNutrientName("Всего углеводов") // → "Углеводы"
 * normalizeNutrientName("Насыщенные жиры") // → " - насыщенные"
 */
export function normalizeNutrientName(name) {
    if (!name) return '';

    const cleaned = name.replace(/:$/, '').trim();

    for (const [regex, normalized] of NORMALIZATION_MAP) {
        if (regex.test(cleaned)) {
            return normalized;
        }
    }

    // Не знайдено - повертаємо як є
    return cleaned;
}
