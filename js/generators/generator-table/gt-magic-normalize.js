// js/generators/generator-table/gt-magic-normalize.js

/**
 * ╔══════════════════════════════════════════════════════════════════════════╗
 * ║                    GT-MAGIC-NORMALIZE v1.0                               ║
 * ║              Нормалізація назв нутрієнтів                                ║
 * ╚══════════════════════════════════════════════════════════════════════════╝
 *
 * ПРИЗНАЧЕННЯ:
 * Спрощує назви нутрієнтів до стандартного вигляду:
 * - "Всего углеводов" → "Углеводы"
 * - "Насыщенные жиры" → " - насыщенные"
 * - "Всього вуглеводів" → "Вуглеводи"
 *
 * ЕКСПОРТ:
 * - normalizeNutrientName(name) - нормалізувати назву
 */

// ============================================================================
// МАПА НОРМАЛІЗАЦІЇ
// ============================================================================

/**
 * Основні нутрієнти (без дефісу)
 */
const MAIN_NUTRIENTS = [
    [/^(калорийность|энергетическая ценность|калорії|енергетична цінність|energy|kcal)$/i, 'Калории'],
    [/^(всего жир(ов|а)?|общ(ее|ий) (содержание )?жир(ов|а)?|total fat|жири|загальний вміст жиру)$/i, 'Жиры'],
    [/^(холестерин(а)?|холестерол|cholesterol)$/i, 'Холестерин'],
    [/^(всего углевод(ов|ы)?|общ(ее|ий) (количество |содержание )?углевод(ов|ы)?|total carb(ohyd)?r?(ate)?s?|вуглеводи|загальна кількість вуглеводів)$/i, 'Углеводы'],
    [/^(белок|белки|белков|білок|білка|білків|protein)$/i, 'Белок'],
    [/^(соль|солі|salt)$/i, 'Соль'],
];

/**
 * Підкатегорії (можуть бути з дефісом або без)
 * Формат: [regex без ^-?\s*, назва для підкатегорії, назва для окремого рядка]
 */
const SUBCATEGORIES = [
    // Жири
    [/(насыщенн?(ые|ых)( жир(ы|ов)?)?|saturated( fat)?|насичені( жири)?)$/i, 'насыщенные', 'Насыщенные жиры'],
    [/(транс[- ]?жир(ы|ов)?|trans( fat)?)$/i, 'транс-жиры', 'Транс-жиры'],
    [/(ненасыщенн?(ые|ых)( жир(ы|ов)?)?|unsaturated|ненасичені)$/i, 'ненасыщенные', 'Ненасыщенные жиры'],
    [/(мононенасыщенн?(ые|ых)?|monounsaturated)$/i, 'мононенасыщенные', 'Мононенасыщенные жиры'],
    [/(полиненасыщенн?(ые|ых)?|polyunsaturated)$/i, 'полиненасыщенные', 'Полиненасыщенные жиры'],
    // Вуглеводи
    [/(пищев(ые|ых) волокн(а|о)?|пищевых волокон|клетчатк(а|и)|dietary fiber|fibre?|харчові волокна)$/i, 'пищевые волокна', 'Пищевые волокна'],
    [/(всего сахар(ов|а)?|сахар(а|ов)?|total sugars?|sugars?|цукор|цукру)$/i, 'сахар', 'Сахар'],
    [/(добавленн?(ый|ого) сахар(а)?|added sugars?|includes.*added|доданий цукор)$/i, 'добавленного сахара', 'Добавленный сахар'],
];

// ============================================================================
// ГОЛОВНА ФУНКЦІЯ
// ============================================================================

/**
 * Нормалізує назву нутрієнту
 * @param {string} name - Оригінальна назва
 * @returns {string} - Нормалізована назва
 *
 * @example
 * normalizeNutrientName("Всего углеводов") // → "Углеводы"
 * normalizeNutrientName("- Насыщенные жиры") // → " - насыщенные" (підкатегорія)
 * normalizeNutrientName("Насыщенные жиры") // → "Насыщенные жиры" (окремо)
 */
export function normalizeNutrientName(name) {
    if (!name) return '';

    const cleaned = name.replace(/:$/, '').trim();

    // Перевіряємо основні нутрієнти
    for (const [regex, normalized] of MAIN_NUTRIENTS) {
        if (regex.test(cleaned)) {
            return normalized;
        }
    }

    // Перевіряємо підкатегорії
    const isSubcategory = /^-\s*/.test(cleaned);
    const withoutDash = cleaned.replace(/^-\s*/, '');

    for (const [regex, subName, standaloneName] of SUBCATEGORIES) {
        if (regex.test(withoutDash)) {
            return isSubcategory ? ' - ' + subName : standaloneName;
        }
    }

    // Не знайдено - повертаємо як є
    return cleaned;
}
