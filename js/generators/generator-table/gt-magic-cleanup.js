// js/generators/generator-table/gt-magic-cleanup.js

/**
 * ╔══════════════════════════════════════════════════════════════════════════╗
 * ║                    GT-MAGIC-CLEANUP v1.0                                 ║
 * ║                  Очистка тексту від сміття                               ║
 * ╚══════════════════════════════════════════════════════════════════════════╝
 *
 * ПРИЗНАЧЕННЯ:
 * Видаляє зайві символи, нормалізує пробіли, готує текст до парсингу.
 *
 * ЕКСПОРТ:
 * - cleanText(text) - очистити текст від сміття
 * - CLEANUP_SYMBOLS - regex символів для видалення
 *
 * ДОДАВАННЯ НОВИХ СИМВОЛІВ:
 * Просто додай символ в CLEANUP_SYMBOLS regex нижче.
 */

// ============================================================================
// СИМВОЛИ ДЛЯ ВИДАЛЕННЯ
// ============================================================================

/**
 * Regex символів які видаляються з тексту
 * Додавай сюди нові символи для очистки
 */
export const CLEANUP_SYMBOLS = /\*\*|[†‡✝×®*•○◊■□▪▫♦◆●▶►▷❖✦✧⬥⬦]/g;

// ============================================================================
// ГОЛОВНА ФУНКЦІЯ
// ============================================================================

/**
 * Очищає текст від сміття
 * @param {string} text - Вхідний текст
 * @returns {string} - Очищений текст
 */
export function cleanText(text) {
    if (!text || typeof text !== 'string') {
        return '';
    }

    return text
        // Видаляємо зайві символи
        .replace(CLEANUP_SYMBOLS, '')
        // Видаляємо відсотки в кінці рядка (включаючи <1%)
        .replace(/\s+[<>]?\s*[\d,.]+%\s*$/gm, '')
        // Табуляції → пробіли
        .replace(/\t+/g, ' ')
        // Тисячні роздільники (1,000 → 1000)
        .replace(/(\d),(\d{3})/g, '$1$2')
        // Кілька пробілів → один
        .replace(/\s{2,}/g, ' ');
}

// ============================================================================
// ДОПОМІЖНІ ФУНКЦІЇ
// ============================================================================

/**
 * Нормалізує десяткові роздільники (кома → крапка)
 * @param {string} text - Текст з числами
 * @returns {string} - Текст з нормалізованими числами
 */
export function normalizeDecimals(text) {
    // 12,5 → 12.5 (але не 1,000 → 1.000)
    return text.replace(/(\d),(\d{1,2})(?!\d)/g, '$1.$2');
}

/**
 * Видаляє HTML теги
 * @param {string} text - Текст з HTML
 * @returns {string} - Чистий текст
 */
export function stripHtml(text) {
    return text.replace(/<[^>]*>/g, '');
}
